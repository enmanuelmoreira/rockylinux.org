<title>{{ .Title }}</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

{{ $styles := resources.Get "css/main.css" }}
{{ $styles = $styles | resources.PostCSS (dict "inlineImports" true) }}

{{ $styles = $styles | minify }}
<link href="{{ $styles.Permalink }}" rel="stylesheet" />

<link href="https://fonts.googleapis.com/css?family=Red+Hat+Display:400,400italic,500,500italic,700,700italic,900,900italic" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Red+Hat+Text:400,400italic,500,500italic,700,700italic" rel="stylesheet" type="text/css" />
<link rel="icon" href="/img/favicon.ico"/>

<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.3.5/dist/alpine.min.js" defer=""></script>

{{ partial "meta/site-twittercard.html" . }}

<script type="text/javascript">

    const languages = [];
    {{ range $.Site.Home.AllTranslations }}
        languages.push('{{ .Language.Lang }}'.toLowerCase())
    {{ end }}

    let parameterLang = getParameterByName("l").toLowerCase();
    if(parameterLang != "") {
        document.cookie = "preferredLanguage=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

        if (languages.includes(parameterLang)) {
            document.cookie = "preferredLanguage=" + parameterLang;
        }
    }

    if (getCookie("preferredLanguage")) {
        var language = getCookie("preferredLanguage");
    }
    else {
        var language = (navigator.language || navigator.userLanguage).substr(0, 2);
        var languageWCountry = (navigator.language || navigator.userLanguage).toLowerCase();
    }

    let hugoLanguage = '{{ i18n "language" . }}'.toLowerCase();
    if (hugoLanguage != language && hugoLanguage != languageWCountry) {
        if (languages.includes(language)) {
            window.location.href = language + "/";
            document.cookie = "preferredLanguage=" + language;
        }
        else if (languages.includes(languageWCountry)) {
            window.location.href = languageWCountry + "/";
            document.cookie = "preferredLanguage=" + languageWCountry;
        }
        else  { // Default to english
            document.cookie = "preferredLanguage=en"
        }
    }

    function getCookie(name) {
       const value = `; ${document.cookie}`;
       const parts = value.split(`; ${name}=`);
       if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

 </script>
